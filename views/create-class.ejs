<%- include('partials/header') %> <%- include('partials/navbar-dash') %>

<link rel="stylesheet" href="../assets/css/class.css" />
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<div class="container-fluid">
  <h1>Your class</h1>
  <!-- The sidebar -->
<div class="sidebar">
  <a class="active" href="/class-info">Class Info</a>
  <a href="/curriculum">Curriculum</a>
  <a href="#contact">Contact</a>
  <a href="#about">About</a>
</div>

<!-- Page content -->
<div class="content">
  <div class="container">
  <div class="card mb-4 user-card shadow-sm">
    <div class="card-header">
      <h4>Class info</h4>
    </div>
    <form id="info-form" method = "post" action = '/class-info'>
      <% if (typeof classes != "undefined" && classes) { %>
        <input type="hidden" name="id" value="<%= classes._id %>">
      <% } %>
      <div class="form-group">
        <label class="label-size" for="">Title</label>
        <input
          name="title"
          type="text"
        
          class="form-control"
          placeholder="Class Title"
          <% if (typeof classes != "undefined" && classes) { %>
            value= '<%= classes.title %>'
          <% } %>        
        />
      </div>

      <div class="form-group">
        <label class="label-size">How would you like your class</label>
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
              name="exampleRadio"
            value="option1"
            
            <% if (typeof classes != "undefined" && !classes.isPaid) { %>
              checked
            <% } %> 
          />
          <label class="form-check-label label-size"> Free </label>
        </div>
        <div class="form-check">
          <input
          id="paidRadio"
            class="form-check-input"
            type="radio"
            name="exampleRadio"
            value="option2"
            <% if (typeof classes != "undefined" && classes.isPaid) { %>
              checked
            <% } %> 
          />
          <label class="form-check-label label-size" for="exampleRadios2">
            Paid
          </label>
        </div>
      </div>
      <div class="form-group price-input hide-class">
          <label class="label-size" for="">Price</label>
          <input
            type=""
            name="price"
            class="form-control"
            placeholder="Price"
            <% if (typeof classes != "undefined" && classes) { %>
              value= '<%= classes.price %>'
            <% } %>
          />
        </div>
      <label class="label-size" for="">Class Duration</label>
      <div class="row">
          
          <div class="col">
              <label class="label-size" for="">From</label>
            <input type="date" class="form-control" id="startDate" name="startDate">
          </div>
     
          <div class="col">
              <label class="label-size" for="">To</label>
            <input type="date" class="form-control" id="endDate" name="endDate">
          </div>
        </div>
        <script>
          <% if (typeof classes != "undefined" && classes) { %>
          var d = new moment('<%= classes.startDate %>')
          var e = new moment('<%= classes.endDate %>')
          console.log(d.format('YYYY-MM-DD'));
          
          document.getElementById('startDate').defaultValue = d.format('YYYY-MM-DD');
          document.getElementById('endDate').defaultValue = e.format('YYYY-MM-DD');
          <% } %>
        </script>
      <div class="form-group">
          <label class="label-size" for="">Class Description</label>
        <textarea
          class="form-control"
          name="description"
          id=""
          cols="30"
          rows="10"
          placeholder="How would you describe your class"
        ><% if (typeof classes != "undefined" && classes) { %><%= classes.description %><% } %></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Save</button>
    </form>
  </div>
</div>
  <!-- <div class="card mb-4 user-card shadow-sm mt-6"> -->
    <!-- <div class="row">
      <div class="col-3">
        <div
          class="nav flex-column nav-pills"
          id="v-pills-tab"
          role="tablist"
          aria-orientation="vertical"
        >
          <a
            class="nav-link active"
            id="v-pills-home-tab"
            data-toggle="pill"
            href="#v-pills-home"
            role="tab"
            aria-controls="v-pills-home"
            aria-selected="true"
            >Class Info<i class="fa fa-info icon-class"></i
          ></a>
          <a
            class="nav-link"
            id="v-pills-profile-tab"
            data-toggle="pill"
            href="#v-pills-profile"
            role="tab"
            aria-controls="v-pills-profile"
            aria-selected="false"
            >Curriculum<i class="fa fa-university icon-class"></i
          ></a>
          <a
            class="nav-link"
            id="v-pills-messages-tab"
            data-toggle="pill"
            href="#v-pills-messages"
            role="tab"
            aria-controls="v-pills-messages"
            aria-selected="false"
            >Assignments<i class="fa fa-book-open icon-class"></i
          ></a>
          <a
            class="nav-link"
            id="v-pills-settings-tab"
            data-toggle="pill"
            href="#v-pills-settings"
            role="tab"
            aria-controls="v-pills-settings"
            aria-selected="false"
            >Course resources<i class="fas fa-tools icon-class"></i
          ></a>
        </div>
      </div>
      <div class="col-9">
        <div class="tab-content" id="v-pills-tabContent">
          <div
            style="margin-left: 40px"
            class="tab-pane tab-item fade show active"
            id="v-pills-home"
            role="tabpanel"
            aria-labelledby="v-pills-home-tab"
          >
            <div class="card-header">
              <h4>Class info</h4>
            </div>
            <div>
              <form id="info-form" method = "post" action = '/class-info'>
                <% if (typeof classes != "undefined" && classes) { %>
                  <input type="hidden" name="id" value="<%= classes._id %>">
                <% } %>
                <div class="form-group">
                  <label class="label-size" for="">Title</label>
                  <input
                    name="title"
                    type="text"
                  
                    class="form-control"
                    placeholder="Class Title"
                    <% if (typeof classes != "undefined" && classes) { %>
                      value= '<%= classes.title %>'
                    <% } %>        
                  />
                </div>

                <div class="form-group">
                  <label class="label-size">How would you like your class</label>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                        name="exampleRadio"
                      value="option1"
                      
                      <% if (typeof classes != "undefined" && !classes.isPaid) { %>
                        checked
                      <% } %> 
                    />
                    <label class="form-check-label label-size"> Free </label>
                  </div>
                  <div class="form-check">
                    <input
                    id="paidRadio"
                      class="form-check-input"
                      type="radio"
                      name="exampleRadio"
                      value="option2"
                      <% if (typeof classes != "undefined" && classes.isPaid) { %>
                        checked
                      <% } %> 
                    />
                    <label class="form-check-label label-size" for="exampleRadios2">
                      Paid
                    </label>
                  </div>
                </div>
                <div class="form-group price-input hide-class">
                    <label class="label-size" for="">Price</label>
                    <input
                      type=""
                      name="price"
                      class="form-control"
                      placeholder="Price"
                      <% if (typeof classes != "undefined" && classes) { %>
                        value= '<%= classes.price %>'
                      <% } %>
                    />
                  </div>
                <label class="label-size" for="">Class Duration</label>
                <div class="row">
                    
                    <div class="col">
                        <label class="label-size" for="">From</label>
                      <input type="date" class="form-control" id="startDate" name="startDate">
                    </div>
               
                    <div class="col">
                        <label class="label-size" for="">To</label>
                      <input type="date" class="form-control" id="endDate" name="endDate">
                    </div>
                  </div>
                  <script>
                    <% if (typeof classes != "undefined" && classes) { %>
                    var d = new moment('<%= classes.startDate %>')
                    var e = new moment('<%= classes.endDate %>')
                    console.log(d.format('YYYY-MM-DD'));
                    
                    document.getElementById('startDate').defaultValue = d.format('YYYY-MM-DD');
                    document.getElementById('endDate').defaultValue = e.format('YYYY-MM-DD');
                    <% } %>
                  </script>
                <div class="form-group">
                    <label class="label-size" for="">Class Description</label>
                  <textarea
                    class="form-control"
                    name="description"
                    id=""
                    cols="30"
                    rows="10"
                    placeholder="How would you describe your class"
                  ><% if (typeof classes != "undefined" && classes) { %><%= classes.description %><% } %></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Save</button>
              </form>
            </div>
          </div>
          <div
            class="tab-pane tab-item fade"
            id="v-pills-profile"
            role="tabpanel"
            aria-labelledby="v-pills-profile-tab"
          >
           <div class="card-header">
              <h4>Curriculum</h4>
            </div>
            <% if (typeof classes != "undefined" && classes) { %>
            <% classes.lesson.forEach(lesson => { %>
              <div class="added-lesson" data-toggle="collapse" href="#m<%= lesson._id %>"  role="button" aria-expanded="false" aria-controls="<%= lesson._id %>">
                <h2><%= lesson.title %> </h2>
                <a href="#" class=""><i class="fas fa-trash-alt delete-icon"></i></a>
                
              </div>  
              <div class="collapse" id="m<%= lesson._id %>" >
                <form action="/edit-lesson" method="post" enctype="multipart/form-data" onsubmit="editLesson()">
                  <input type="hidden" name="id" value="<%= classes._id %>">
                  <div class="form-group">
                    <label for="">Lesson Title</label>
                    <input type="text" name="title" class="form-control" value="<%= lesson.title %>" >
                  </div>
                  <p style="color: red; font-size: 10px;" id="alert<%= lesson._id %>"></p>
                  <label for="">Lesson Video (<=100mb)</label>    
                    <div class="form-group video-input">            
                      <div class="lesson-video-src">
                        <video width="100%" id="video<%= lesson._id %>" controls class="lesson-video-src" preload="auto">  
                             <source id="source<%= lesson._id %>" src="<%= lesson.video %> " type="">            
                        Your browser does not support the video tag.
                        </video>
                   
                      </div>
                      
                      <button type="button" id="button<%= lesson._id %>" onclick="defaultBtnActive()" class="upload-button btn btn-primary">Upload Video</button>
                    </div>
                    <input id="default<%= lesson._id %>" type="file" name="edited-lesson-video" accept="video/*" >
                   
                      <span>Lesson</span>
                      <div id="toolbar"></div>
                      <div id="editor<%= lesson._id %>" class="lesson-editor"></div>
                      <input id="l<%= lesson._id %>" type="hidden" name="content" />
                      <script> 
                        //  const videoSrc = document.querySelector("#source<%= lesson._id %>");
                        //   const videoTag = document.querySelector("#video<%= lesson._id %>");
                        //   const inputTag = document.querySelector("#default<%= lesson._id %>");

                        //   console.log(inputTag);

                        //   inputTag.addEventListener('change',  readVideo)

                        //   function readVideo(event) {
                        //     console.log('<%= lesson._id %>');
                        //     console.log(event.target.files)
                        //     if (event.target.files && event.target.files[0]) {
                        //       var reader = new FileReader();
                              
                        //       reader.onload = function(e) {
                        //         console.log('loaded')
                        //         videoSrc.src = e.target.result
                        //         videoTag.load()
                        //       }.bind(this)

                        //       reader.readAsDataURL(event.target.files[0]);
                        //     }
                        //   }
                         




                        var toolbarOptions = [
                          ["bold", "italic", "underline", "strike"], // toggled buttons
                          ["blockquote", "code-block"],
      
                          [{ header: 1 }, { header: 2 }], // custom button values
                          [{ list: "ordered" }, { list: "bullet" }],
                          [{ script: "sub" }, { script: "super" }], // superscript/subscript
                          [{ indent: "-1" }, { indent: "+1" }], // outdent/indent
                          [{ direction: "rtl" }], // text direction
      
                          [{ size: ["small", false, "large", "huge"] }], // custom dropdown
                          [{ header: [1, 2, 3, 4, 5, 6, false] }],
      
                          [{ color: [] }, { background: [] }], // dropdown with defaults from theme
                          [{ font: [] }],
                          [{ align: [] }],
                          ["link", "image", "video", "formula"],
      
                          ["clean"], // remove formatting button
                        ];
                        var editor = document.querySelector("#editor<%= lesson._id %>");
                        console.log(editor);
                        var options = {
                          debug: "info",
                          modules: {
                            toolbar: toolbarOptions,
                          },
                          placeholder: "Use the formatting tools to create your lessons",
      
                          theme: "snow",
                        };
                        var quill = new Quill(editor, options);
                        var words = '<%- lesson.content %>'
                        var newContent = JSON.parse(words.replace(/\n/g, '\\n'));
                        quill.setContents(newContent);
                        function editLesson() {
                          console.log('#l<%= lesson._id %>');
                          console.log(quill.getContents());
                          document.querySelector("#l<%= lesson._id %>").value = JSON.stringify(
                            
                            quill.getContents()
                          );
                        }
                      </script>
                      <input type="hidden" name="lessonId" value=<%= lesson._id %> >
                  <button type="submit" id="submitBtn" class="btn btn-primary" name="isEdit" value="true">Edit</button>
                </form>
              </div>
            <% }) %>
            <% } %>
          
          <form action="/upload-lesson" method="post" enctype="multipart/form-data" onsubmit="getLesson()">
            <input type="hidden" name="id" value="<%= classes._id %>">
            <div class="form-group">
              <label for="">Lesson Title</label>
              <input type="text" name="title" class="form-control" value="New Lesson">
            </div>
            <p style="color: red; font-size: 10px;" id="alertParagraph"></p>
            <label for="">Lesson Video (<=100mb)</label>    
              <div class="form-group video-input">            
                <div class="lesson-video-src">
                  <video width="100%" id="uploaded-video" autoplay controls class="lesson-video-src">                  
                  Your browser does not support the video tag.
                  </video>                    
                </div>
                
                <button type="button" id="uploadBtn" onclick="btnActive()" class="upload-button btn btn-primary">Upload Video</button>
              </div>
              <input id="defaultBtn" type="file" name="lesson-video" accept="video/*" hidden>

                <span>Lesson</span>
                <div id="toolbar"></div>
                <div id="editor" class="lesson-editor"></div>
                <input id="quillId" type="hidden" name="content" />
                <script>
                  var toolbarOptions = [
                    ["bold", "italic", "underline", "strike"], // toggled buttons
                    ["blockquote", "code-block"],

                    [{ header: 1 }, { header: 2 }], // custom button values
                    [{ list: "ordered" }, { list: "bullet" }],
                    [{ script: "sub" }, { script: "super" }], // superscript/subscript
                    [{ indent: "-1" }, { indent: "+1" }], // outdent/indent
                    [{ direction: "rtl" }], // text direction

                    [{ size: ["small", false, "large", "huge"] }], // custom dropdown
                    [{ header: [1, 2, 3, 4, 5, 6, false] }],

                    [{ color: [] }, { background: [] }], // dropdown with defaults from theme
                    [{ font: [] }],
                    [{ align: [] }],
                    ["link", "image", "video", "formula"],

                    ["clean"], // remove formatting button
                  ];
                  var editor = document.querySelector("#editor");
                  var options = {
                    debug: "info",
                    modules: {
                      toolbar: toolbarOptions,
                    },
                    placeholder: "Use the formatting tools to create your lessons",

                    theme: "snow",
                  };
                  var quill = new Quill(editor, options);
                  function getLesson() {
                    document.querySelector("#quillId").value = JSON.stringify(
                      quill.getContents()
                    );
                  }
                </script>
            <button type="submit" id="submitBtn" class="btn btn-primary">Submit</button>
          </form>
          </div>
          <div
            class="tab-pane tab-item fade"
            id="v-pills-messages"
            role="tabpanel"
            aria-labelledby="v-pills-messages-tab"
          >
            
          </div>
          <div
            class="tab-pane tab-item fade"
            id="v-pills-settings"
            role="tabpanel"
            aria-labelledby="v-pills-settings-tab"
          >
            ...
          </div>
        </div>
      </div>
    </div> -->
    </div>
  </div>
</div>
<%- include('partials/footer') %>
